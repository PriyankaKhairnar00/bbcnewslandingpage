"use strict";try{window.googletag=window.googletag||{cmd:[]};var t={config:Object.freeze({ver:1.12,category:10,keyword:30,pvInerval:2592e3,repUserTime:86400,repVisitTime:2592e3,sessgeo:"https://feeds.intoday.in/geocheck",sessdet:"https://"+location.hostname+"/ssoinfo",mobprices:"https://recengine.intoday.in/recengine/uaparser/getmodelprice",sgmnts:"https://recengine.intoday.in/recengine/cdp/get_user_segment"}),timestamp:Math.floor(Date.now()/1e3),schModel:{pv:{tc:0,mc:0},sections:[],keywords:[],ts:0,repu:"0",urv:[],ct:0,geo:{regcod:null,city:null,cntcod:null},cke:{spitgd:null},sespro:null,dvcobj:{ts:0,pribnd:"NA",pricat:"NA"},sgmObj:{sgmts:[],ts:0}},init:function(t){null!=t&&(this.schModel.ts=this.timestamp,this.schModel.ct=this.timestamp,Object.freeze(this.schModel),this.getData(t))},getData:function(t){if(googletag&&googletag.apiReady){this.timestamp=Math.floor(Date.now()/1e3);let e=this.isJson(this.getLocalStorage("itgdTrackdata"));if(this.isEmpty(e))e=Object.assign({},this.schModel);else for(let[s,i]of Object.entries(this.schModel))e.hasOwnProperty(s)||(e[s]=i);e.pv.tc=e.pv.tc+1,e.pv.mc=e.pv.mc+1;let o=googletag.pubads().getTargeting("category").slice(0,1),n=googletag.pubads().getTargeting("keywords").slice(0,3),r=this;o.forEach(function(t){let s={na:t,cnt:1},i=e.sections.findIndex(e=>!r.isEmpty(e)&&e.na==t);i>-1?(s=e.sections[i]).cnt="cnt"in s?parseInt(s.cnt)+1:1:(e.sections.length>=r.config.category&&(e.sections.sort((t,e)=>t.cnt>e.cnt?-1:t.cnt<e.cnt?1:0),e.sections=e.sections.slice(0,r.config.category)),e.sections.push(s))}),e.keywords=[...new Set([...e.keywords,...n])],e.keywords.length>this.config.keyword&&(e.keywords=e.keywords.slice(e.keywords.length-this.config.keyword));let c=0;"ts"in e&&((c=this.timestamp-e.ts)>=this.config.repUserTime&&(e.repu="1",e.ts=this.timestamp),c>=this.config.repVisitTime&&-1==e.urv.indexOf("30d")&&e.urv.push("30d"),c>=this.config.pvInerval&&(e.pv.mc=0));let a=this.getCookie("sp_itgd");this.isEmpty(a)||(e.cke.spitgd=a),this.setLocalStorage("itgdTrackdata",JSON.stringify(e)),this.getMobPriceBand(e),r.getSessPro(e,c),this.getLocation(e),this.getSegment(e)}},getLocation:function(t,e=null){let s=this;this.isEmpty(t)||this.apiCall(this.config.sessgeo,"GET").then(i=>{"region_code"in i&&!s.isEmpty(i.region_code)&&(t.geo={regcod:i.region_code,city:i.city,cntcod:i.country_code},s.setLocalStorage("itgdTrackdata",JSON.stringify(t))),"function"==typeof e&&e()},t=>{console.log("Issue in Location API",t),"function"==typeof e&&e()})},getSessPro:function(t,e){let s=this.getCookie("itg_forced_login");if(this.isEmpty(s)||this.isEmpty(t))!this.isEmpty(t)&&"sespro"in t&&(t.sespro=null,this.setLocalStorage("itgdTrackdata",JSON.stringify(t)));else if(0==e||e>=this.config.repUserTime||this.isEmpty(t.sespro)){this.getCookie("itg_sso_uid"),t.sespro=null,this.setLocalStorage("itgdTrackdata",JSON.stringify(t));let i=this;this.apiCall(this.config.sessdet,"POST").then(e=>{"status_code"in e&&!i.isEmpty(e.data.uid)&&(t.sespro=e.data,i.setLocalStorage("itgdTrackdata",JSON.stringify(t)))},t=>{console.log("Issue in SSo sess API",t)})}},getMobPriceBand:function(t){let e=this;!this.isEmpty(t)&&"NA"==t.dvcobj.pricat&&t.dvcobj.ts+604800<=this.timestamp&&this.apiCall(this.config.mobprices,"GET").then(s=>{t.dvcobj.ts=e.timestamp,t.dvcobj.pribnd=s.output.price_band,t.dvcobj.pricat=s.output.price_category,e.setLocalStorage("itgdTrackdata",JSON.stringify(t))},t=>{console.log("Issue in price band sess API",t)})},getSegment:function(t){let e=this;if(!this.isEmpty(t)&&(null!=t.sespro||null==t.sespro&&null!=t.cke.spitgd&&t.pv.tc>3)&&t.sgmObj.ts+this.config.repUserTime<=this.timestamp){let s={uid:t.cke.spitgd};null!=t.sespro&&(s.login=t.sespro.uid),this.apiCall(this.config.sgmnts,"GET",s).then(s=>{t.sgmObj.ts=e.timestamp,t.sgmObj.sgmts=s.mapping,e.setLocalStorage("itgdTrackdata",JSON.stringify(t))},t=>{console.log("Issue in segment API",t)})}},toBinary:function(t){let e=new Uint16Array(t.length);for(let s=0;s<e.length;s++)e[s]=t.charCodeAt(s);return String.fromCharCode(...new Uint8Array(e.buffer))},isEmpty:function(t){return null==t||"null"==t||"false"==t||!1==t||"undefined"==t||t.constructor===Object&&0==Object.keys(t).length},isJson:function(t){try{return JSON.parse(t)}catch(e){return!1}},disableEvent:function(t){t.style.pointerEvents="none",t.setAttribute("disabled",!0)},enableEvent:function(t){t.removeAttribute("style"),t.removeAttribute("disabled")},getCookie:function(t){var e=("; "+document.cookie).split("; "+t+"=");return 2==e.length&&e.pop().split(";").shift()},setLocalStorage:function(t,e){try{window.localStorage.setItem(t,e)}catch(s){}},getLocalStorage:function(t){try{return window.localStorage.getItem(t)}catch(e){return!1}},removeLocalStorage:function(t){window.localStorage.removeItem(t)},addClickListner:function(t,e,s){null!=s&&null!=e&&("object"==typeof t?t:document.querySelector(t)).addEventListener(e,s)},apiCall:function(t,e,s=""){let i=this;return new Promise((o,n)=>{let r=Object.assign({},s);var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),a="string"==typeof r?r:Object.keys(r).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(r[t])}).join("&");"get"==e.toLowerCase()?(t+="?"+a,c.open(e,t)):(c.open(e,t),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.setRequestHeader("X-Requested-With","XMLHttpRequest")),c.onreadystatechange=function(){c.onload=()=>{let t=c.responseText;c.getResponseHeader("Content-Type").split(";"),t=i.isJson(c.responseText),4==this.readyState&&200==this.status?o(t):n(t)},c.onerror=()=>n(c.statusText)},c.send(a)})}};window.addEventListener("load",function(){t.init({})})}catch(e){console.log("error",e)}